{"remainingRequest":"D:\\JayResp\\vuevhr\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\JayResp\\vuevhr\\src\\components\\sys\\basic\\PermissMana.vue?vue&type=style&index=0&lang=css&","dependencies":[{"path":"D:\\JayResp\\vuevhr\\src\\components\\sys\\basic\\PermissMana.vue","mtime":1582246340727},{"path":"D:\\JayResp\\vuevhr\\node_modules\\css-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\JayResp\\vuevhr\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":499162500000},{"path":"D:\\JayResp\\vuevhr\\node_modules\\postcss-loader\\src\\index.js","mtime":499162500000},{"path":"D:\\JayResp\\vuevhr\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\JayResp\\vuevhr\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoucGVybWlzc01hbmFUb29scyB7CiAgZGlzcGxheTogZmxleDsKfQoKLnBlcm1pc3NNYW5hVG9vbHMgLmVsLWlucHV0IHsKICB3aWR0aDogMzAwcHg7CiAgbWFyZ2luLXJpZ2h0OiA1cHg7Cn0K"},{"version":3,"sources":["PermissMana.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA+IA;AACA;AACA;;AAEA;AACA;AACA;AACA","file":"PermissMana.vue","sourceRoot":"src/components/sys/basic","sourcesContent":["<template>\r\n    <div>\r\n        <div class=\"permissManaTools\">\r\n            <el-input placeholder=\"请输入角色英文名\" v-model=\"role.name\" size=\"small\">\r\n                <template slot=\"prepend\">ROLE_</template>\r\n            </el-input>\r\n            <el-input placeholder=\"请输入角色中文名\" v-model=\"role.nameZh\" size=\"small\" @keydown.enter.native=\"addRole\"></el-input>\r\n            <el-button type=\"primary\" size=\"small\" icon=\"el-icon-plus\" @click=\"addRole\">添加角色</el-button>\r\n        </div>\r\n        <div style=\"margin-top: 5px;width:700px\">\r\n            <el-collapse accordion @change=\"change\" v-model=\"activeName\">\r\n                <!--     @change是折叠面板独有的方法，指点到哪个，就加载哪个的数据，传入的参数，默认是他下面子控件的name           -->\r\n                <el-collapse-item :title=\"r.nameZh\" :key=\"index\" v-for=\"(r,index) in roles\" :name=\"r.id\">\r\n                    <el-card class=\"box-card\">\r\n                        <div slot=\"header\" class=\"clearfix\">\r\n                            <span>可访问资源</span>\r\n                            <el-button style=\"float: right; padding: 3px 0;color: red\" type=\"text\" icon=\"el-icon-delete\" @click=\"deleteRole(r)\"></el-button>\r\n                        </div>\r\n                        <div>\r\n                            <el-tree :data=\"allMenus\" :props=\"defaultProps\"\r\n                                     show-checkbox node-key=\"id\" :default-checked-keys=\"selectedMenus\"\r\n                                     ref=\"tree\"\r\n                                     :key=\"index\"></el-tree>\r\n                            <!--  data属性是树形控件底下的数据，props往下找，说不清,show-checkbox显示多选框    -->\r\n                            <!--  默认选中的表示为node-key，这里以数据里面的id为标识，default-checked-keys代表默认选中id为7,8,9的项 -->\r\n                            <!--  ref属性就是给这些树形控件起了个名字，每个角色里面都有一个树形控件，也就是说总共有8个控件，那么这个ref就是一个长度为8的数组,故下面还要传入索引去获取当前的树形控件-->\r\n                            <div style=\"display: flex;justify-content: flex-end\">\r\n                                <el-button size=\"small\" @click=\"cancelUpdate\">取消修改</el-button>\r\n                                <el-button size=\"small\" type=\"primary\" @click=\"doUpdate(r.id,index)\">确认修改</el-button>\r\n                            </div>\r\n                        </div>\r\n                    </el-card>\r\n                </el-collapse-item>\r\n            </el-collapse>\r\n        </div>\r\n    </div>\r\n</template>\r\n\r\n<script>\r\n    export default {\r\n        name: \"PermissMana\",\r\n        data() {\r\n            return {\r\n                role: {\r\n                    name: '',\r\n                    nameZh: ''\r\n                },\r\n                roles:[],\r\n                allMenus:[],\r\n                selectedMenus:[],  //权限组打了勾组成的数组\r\n                activeName:-1, //这个值是多少，风琴面板就打开哪个；打开风琴面板时，风琴面板里面的每一个name都会给他赋值\r\n                defaultProps:{\r\n                    children: 'children',\r\n                    label: 'name'\r\n                }\r\n            }\r\n        },\r\n        mounted() {\r\n            this.initRoles();\r\n        },\r\n        methods:{\r\n            deleteRole(r){\r\n                this.$confirm('此操作将永久删除【'+r.nameZh+'】角色, 是否继续?', '提示', {\r\n                    confirmButtonText: '确定',\r\n                    cancelButtonText: '取消',\r\n                    type: 'warning'\r\n                }).then(() => {\r\n                    this.deleteRequest(\"/system/basic/permiss/?id=\"+r.id).then(resp=>{\r\n                        if (resp){\r\n                            this.initRoles();\r\n                        }\r\n                    })\r\n                }).catch(() => {\r\n                    this.$message({\r\n                        type: 'info',\r\n                        message: '已取消删除'\r\n                    });\r\n                });\r\n            },\r\n            addRole(){\r\n                if (this.role.name && this.role.nameZh){\r\n                    this.postRequest(\"/system/basic/permiss/role\",this.role).then(resp=>{\r\n                        if (resp){\r\n                            this.role={\r\n                                name : '',\r\n                                nameZh : ''\r\n                            }\r\n                            this.initRoles();\r\n                        }\r\n                    })\r\n                }else{\r\n                   this.$message.error(\"请按规定输入所需要的字段!\");\r\n                }\r\n            },\r\n            cancelUpdate(){\r\n              this.activeName=-1;\r\n            },\r\n            doUpdate(rid,index){\r\n               let tree = this.$refs.tree[index];\r\n               let selectedKeys = tree.getCheckedKeys(true); //getCheckedKeys方法用于获取当前树形控件选中的node-key,传入true的话，即代表只会获取叶子节点（即最低端的那些）\r\n               let url = '/system/basic/permiss/?rid='+rid;\r\n               selectedKeys.forEach(key=>{\r\n                   url+='&mids='+key;\r\n               });\r\n               this.putRequest(url).then(resp=>{\r\n                   if (resp){\r\n                       this.activeName=-1;\r\n                   }\r\n               })\r\n            },\r\n            initSelectedMenus(rid){\r\n                this.getRequest(\"/system/basic/permiss/mids/\"+rid).then(resp=>{\r\n                      if (resp){\r\n                          this.selectedMenus = resp;\r\n                      }\r\n                })\r\n            },\r\n            initRoles(){\r\n                this.getRequest(\"/system/basic/permiss/\").then(resp=>{\r\n                    if (resp){\r\n                        this.roles = resp;\r\n                    }\r\n                })\r\n            },\r\n            change(rid){\r\n               alert(rid);\r\n               if (rid){\r\n                  this.initAllMenus();\r\n                  this.initSelectedMenus(rid);\r\n               }\r\n            },\r\n            initAllMenus(){\r\n                this.getRequest(\"/system/basic/permiss/menus\").then(resp=>{\r\n                    if (resp){\r\n                        this.allMenus=resp;\r\n                    }\r\n                })\r\n            }\r\n        }\r\n    }\r\n</script>\r\n\r\n<style>\r\n    .permissManaTools {\r\n      display: flex;\r\n    }\r\n\r\n    .permissManaTools .el-input {\r\n      width: 300px;\r\n      margin-right: 5px;\r\n    }\r\n</style>"]}]}