{"remainingRequest":"D:\\JayResp\\vuevhr\\node_modules\\babel-loader\\lib\\index.js!D:\\JayResp\\vuevhr\\src\\store\\index.js","dependencies":[{"path":"D:\\JayResp\\vuevhr\\src\\store\\index.js","mtime":1583375931851},{"path":"D:\\JayResp\\vuevhr\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\JayResp\\vuevhr\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IFZ1ZSBmcm9tICJ2dWUiOwppbXBvcnQgVnVleCBmcm9tICJ2dWV4IjsKaW1wb3J0IHsgTm90aWZpY2F0aW9uIH0gZnJvbSAnZWxlbWVudC11aSc7CmltcG9ydCB7IGdldFJlcXVlc3QgfSBmcm9tICIuLi91dGlscy9hcGkiOwppbXBvcnQgU29ja0pTIGZyb20gJ3NvY2tqcy1jbGllbnQnOwppbXBvcnQgU3RvbXAgZnJvbSAnc3RvbXBqcyc7ClZ1ZS51c2UoVnVleCk7CnZhciBub3cgPSBuZXcgRGF0ZSgpOwp2YXIgc3RvcmUgPSBuZXcgVnVleC5TdG9yZSh7CiAgc3RhdGU6IHsKICAgIHJvdXRlczogW10sCiAgICBzZXNzaW9uczoge30sCiAgICBocnM6IFtdLAogICAgLy/mi7/liLDpmaTkuoblvZPliY3nmbvlvZXogIXkuYvlpJbnmoTmiYDmnInlkZjlt6UKICAgIGN1cnJlbnRTZXNzaW9uOiBudWxsLAogICAgLy/lvZPliY3pgInkuK3osIHvvIjljbPlvZPliY3kuI7osIHmraPlnKjogYrlpKnvvIkKICAgIGN1cnJlbnRIcjogSlNPTi5wYXJzZSh3aW5kb3cuc2Vzc2lvblN0b3JhZ2UuZ2V0SXRlbSgidXNlciIpKSwKICAgIC8v5b2T5YmN55qE55m75b2V6ICFCiAgICBmaWx0ZXJLZXk6ICcnLAogICAgc3RvbXA6IG51bGwsCiAgICBpc0RvdDoge30KICB9LAogIG11dGF0aW9uczogewogICAgaW5pdFJvdXRlczogZnVuY3Rpb24gaW5pdFJvdXRlcyhzdGF0ZSwgZGF0YSkgewogICAgICBzdGF0ZS5yb3V0ZXMgPSBkYXRhOwogICAgfSwKICAgIElOSVRfQ1VSUkVOVEhSOiBmdW5jdGlvbiBJTklUX0NVUlJFTlRIUihzdGF0ZSwgaHIpIHsKICAgICAgc3RhdGUuY3VycmVudEhyID0gaHI7CiAgICB9LAogICAgY2hhbmdlQ3VycmVudFNlc3Npb246IGZ1bmN0aW9uIGNoYW5nZUN1cnJlbnRTZXNzaW9uKHN0YXRlLCBjdXJyZW50U2Vzc2lvbikgewogICAgICBWdWUuc2V0KHN0YXRlLmlzRG90LCBzdGF0ZS5jdXJyZW50SHIudXNlcm5hbWUgKyAnIycgKyBjdXJyZW50U2Vzc2lvbi51c2VybmFtZSwgZmFsc2UpOwogICAgICBzdGF0ZS5jdXJyZW50U2Vzc2lvbiA9IGN1cnJlbnRTZXNzaW9uOwogICAgfSwKICAgIGFkZE1lc3NhZ2U6IGZ1bmN0aW9uIGFkZE1lc3NhZ2Uoc3RhdGUsIG1zZykgewogICAgICAvL3Nlc3Npb25z5piv5LiA5Liqa2V5L3ZhbHVl55qE5b2i5byP77yMa2V55piv6LCB5ZKM6LCB6IGK5aSp77yMdmFsdWXmmK/ogYrlpKnnmoTlhoXlrrkKICAgICAgdmFyIG1zcyA9IHN0YXRlLnNlc3Npb25zW3N0YXRlLmN1cnJlbnRIci51c2VybmFtZSArICcjJyArIG1zZy50b107CgogICAgICBpZiAoIW1zcykgewogICAgICAgIC8vIHN0YXRlLnNlc3Npb25zW3N0YXRlLmN1cnJlbnRIci51c2VybmFtZSsnIycrbXNnLnRvXSA9IFtdOwogICAgICAgIC8v5b2T6IGK5aSp5Y+R6YCB5raI5oGv5pe277yM5Lya6Ieq5Yqo5Yi35paw6IGK5aSp6aG1CiAgICAgICAgVnVlLnNldChzdGF0ZS5zZXNzaW9ucywgc3RhdGUuY3VycmVudEhyLnVzZXJuYW1lICsgJyMnICsgbXNnLnRvLCBbXSk7CiAgICAgIH0KCiAgICAgIHN0YXRlLnNlc3Npb25zW3N0YXRlLmN1cnJlbnRIci51c2VybmFtZSArICcjJyArIG1zZy50b10ucHVzaCh7CiAgICAgICAgY29udGVudDogbXNnLmNvbnRlbnQsCiAgICAgICAgZGF0ZTogbmV3IERhdGUoKSwKICAgICAgICBzZWxmOiAhbXNnLm5vdFNlbGYKICAgICAgfSk7CiAgICB9LAogICAgSU5JVF9EQVRBOiBmdW5jdGlvbiBJTklUX0RBVEEoc3RhdGUpIHsKICAgICAgLy/mtY/op4jlmajmnKzlnLDnmoTljoblj7LogYrlpKnorrDlvZXlj6/ku6XlnKjov5nph4zlrozmiJAKICAgICAgdmFyIGRhdGEgPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgndnVlLWNoYXQtc2Vzc2lvbicpOwoKICAgICAgaWYgKGRhdGEpIHsKICAgICAgICBzdGF0ZS5zZXNzaW9ucyA9IEpTT04ucGFyc2UoZGF0YSk7CiAgICAgIH0KICAgIH0sCiAgICAvL+aKiumZpOS6hueZu+W9leiAheS5i+WklueahOWFtuS7luaIkOWRmOaLv+WIsO+8jOaUvuWIsGhyc+mHjOmdouWOuwogICAgSU5JVF9IUjogZnVuY3Rpb24gSU5JVF9IUihzdGF0ZSwgZGF0YSkgewogICAgICBzdGF0ZS5ocnMgPSBkYXRhOwogICAgfQogIH0sCiAgYWN0aW9uczogewogICAgLy/or6Xmlrnms5XnlKjkuo7nmbvpmYbkuYvlkI7lsLHpqazkuIrov57mjqXkuIrogYrlpKkKICAgIGNvbm5lY3Q6IGZ1bmN0aW9uIGNvbm5lY3QoY29udGV4dCkgewogICAgICAvL+WGmeS4iui/nuaOpeWcsOWdgO+8jOS5n+WwseaYr+WQjuWPsFdlYlNvY2tldENvbmZpZ+mFjee9ruexu+mCo+mHjOmFjee9rueahHJlZ2lzdGVyU3RvbXBFbmRwb2ludHMKICAgICAgY29udGV4dC5zdGF0ZS5zdG9tcCA9IFN0b21wLm92ZXIobmV3IFNvY2tKUygnL3dzL2VwJykpOyAvL+WPkei1t+i/nuaOpe+8jOesrOS4gOS4quWPguaVsOaYr+S4gOS6m+mineWklueahOmAiemhue+8jOi/memHjOWPr+S7peaaguaXtuS4jeWhq++8m+esrOS6jOS4quWPguaVsOWwseaYr+i/nuaOpeaIkOWKn+eahOWbnuiwg++8m+esrOS4ieS4quWImeaYr+i/nuaOpeWksei0peeahOWbnuiwgwoKICAgICAgY29udGV4dC5zdGF0ZS5zdG9tcC5jb25uZWN0KHt9LCBmdW5jdGlvbiAoc3VjY2VzcykgewogICAgICAgIC8v6K6i6ZiF5raI5oGv77yM6L+Z6YeM55qE6Lev5b6E5YmN6Z2i5LiA5a6a6KaB5Yqg5YmN57yAdXNlcu+8jOWOn+eQhuWSjFNwcmluZ1NlY3VyaXR56KeS6Imy5YmN6Z2i5YqgUk9MReS4gOagt++8m21zZ+WwseaYr+acjeWKoeerr+WPkeWbnuadpeeahOa2iOaBrwogICAgICAgIGNvbnRleHQuc3RhdGUuc3RvbXAuc3Vic2NyaWJlKCcvdXNlci9xdWV1ZS9jaGF0JywgZnVuY3Rpb24gKG1zZykgewogICAgICAgICAgdmFyIHJlY2VpdmVNc2cgPSBKU09OLnBhcnNlKG1zZy5ib2R5KTsgLy9tc2fkuK3nmoRib2R55omN5piv5raI5oGv5YaF5a65CgogICAgICAgICAgaWYgKCFjb250ZXh0LnN0YXRlLmN1cnJlbnRTZXNzaW9uIHx8IHJlY2VpdmVNc2cuZnJvbSAhPSBjb250ZXh0LnN0YXRlLmN1cnJlbnRTZXNzaW9uLnVzZXJuYW1lKSB7CiAgICAgICAgICAgIE5vdGlmaWNhdGlvbi5pbmZvKHsKICAgICAgICAgICAgICB0aXRsZTogJ+OAkCcgKyByZWNlaXZlTXNnLmZyb21OaWNrbmFtZSArICfjgJHlj5HmnaXkuIDmnaHmtojmga8nLAogICAgICAgICAgICAgIG1lc3NhZ2U6IHJlY2VpdmVNc2cuY29udGVudC5sZW5ndGggPiAxMCA/IHJlY2VpdmVNc2cuY29udGVudC5zdWJzdHIoMCwgMTApIDogcmVjZWl2ZU1zZy5jb250ZW50LAogICAgICAgICAgICAgIHBvc2l0aW9uOiAnYm90dG9tLXJpZ2h0JwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgVnVlLnNldChjb250ZXh0LnN0YXRlLmlzRG90LCBjb250ZXh0LnN0YXRlLmN1cnJlbnRIci51c2VybmFtZSArICcjJyArIHJlY2VpdmVNc2cuZnJvbSwgdHJ1ZSk7CiAgICAgICAgICB9CgogICAgICAgICAgcmVjZWl2ZU1zZy5ub3RTZWxmID0gdHJ1ZTsgLy/mjqXmlLbliLDnmoTkv6Hmga/lubbkuI3mmK/mjqXmlLbkurrlj5HpgIHnmoTvvIzogIzmmK/lr7nmlrnlj5Hkv6Hmga/ov4fmnaXnmoQKCiAgICAgICAgICByZWNlaXZlTXNnLnRvID0gcmVjZWl2ZU1zZy5mcm9tOyAvL3Rv6KaB5pS55oiQZnJvbe+8jOS4vuS4quS+i+WtkO+8muaIkei3n+adjueZveivtOivne+8jOaIkeWPkeWHuuWOu+eahOa2iOaBr++8jOadjueZveaOpeaUtuS6hu+8m+iLpeS4jeWBmuWkhOeQhu+8jOmCo+S5iOWwseWPmOaIkOS6huadjueZvei3n+adjueZveWcqOWvueivnQoKICAgICAgICAgIGNvbnRleHQuY29tbWl0KCdhZGRNZXNzYWdlJywgcmVjZWl2ZU1zZyk7CiAgICAgICAgfSk7CiAgICAgIH0sIGZ1bmN0aW9uIChlcnJvcikge30pOwogICAgfSwKICAgIGluaXREYXRhOiBmdW5jdGlvbiBpbml0RGF0YShjb250ZXh0KSB7CiAgICAgIGNvbnRleHQuY29tbWl0KCdJTklUX0RBVEEnKTsKICAgICAgZ2V0UmVxdWVzdCgiL2NoYXQvaHJzIikudGhlbihmdW5jdGlvbiAocmVzcCkgewogICAgICAgIGlmIChyZXNwKSB7CiAgICAgICAgICBjb250ZXh0LmNvbW1pdCgnSU5JVF9IUicsIHJlc3ApOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9CiAgfQp9KTsKc3RvcmUud2F0Y2goZnVuY3Rpb24gKHN0YXRlKSB7CiAgcmV0dXJuIHN0YXRlLnNlc3Npb25zOwp9LCBmdW5jdGlvbiAodmFsKSB7CiAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oJ3Z1ZS1jaGF0LXNlc3Npb24nLCBKU09OLnN0cmluZ2lmeSh2YWwpKTsKfSwgewogIGRlZXA6IHRydWUKICAvKui/meS4quiyjOS8vOaYr+W8gOWQr3dhdGNo55uR5rWL55qE5Yik5patLOWumOaWueivtOaYjuS5n+avlOi+g+aooeeziiovCgp9KTsKZXhwb3J0IGRlZmF1bHQgc3RvcmU7"},{"version":3,"sources":["D:/JayResp/vuevhr/src/store/index.js"],"names":["Vue","Vuex","Notification","getRequest","SockJS","Stomp","use","now","Date","store","Store","state","routes","sessions","hrs","currentSession","currentHr","JSON","parse","window","sessionStorage","getItem","filterKey","stomp","isDot","mutations","initRoutes","data","INIT_CURRENTHR","hr","changeCurrentSession","set","username","addMessage","msg","mss","to","push","content","date","self","notSelf","INIT_DATA","localStorage","INIT_HR","actions","connect","context","over","success","subscribe","receiveMsg","body","from","info","title","fromNickname","message","length","substr","position","commit","error","initData","then","resp","watch","val","setItem","stringify","deep"],"mappings":"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","sourcesContent":["import Vue from \"vue\";\r\nimport Vuex from \"vuex\";\r\nimport { Notification } from 'element-ui';\r\nimport {getRequest} from \"../utils/api\";\r\nimport SockJS from 'sockjs-client';\r\nimport Stomp from 'stompjs';\r\n\r\n\r\nVue.use(Vuex);\r\n\r\nconst now = new Date();\r\n\r\nconst store = new Vuex.Store({\r\n    state: {\r\n        routes: [],\r\n        sessions: {},\r\n        hrs: [],  //拿到除了当前登录者之外的所有员工\r\n        currentSession: null,  //当前选中谁（即当前与谁正在聊天）\r\n        currentHr: JSON.parse(window.sessionStorage.getItem(\"user\")),  //当前的登录者\r\n        filterKey: '',\r\n        stomp: null,\r\n        isDot: {}\r\n    },\r\n    mutations: {\r\n        initRoutes(state,data){\r\n            state.routes = data;\r\n        },\r\n        INIT_CURRENTHR(state, hr) {\r\n            state.currentHr = hr;\r\n        },\r\n        changeCurrentSession(state, currentSession) {\r\n            Vue.set(state.isDot, state.currentHr.username + '#' + currentSession.username, false);\r\n            state.currentSession = currentSession;\r\n        },\r\n        addMessage(state, msg) {\r\n            //sessions是一个key/value的形式，key是谁和谁聊天，value是聊天的内容\r\n            let mss = state.sessions[state.currentHr.username + '#' + msg.to];\r\n            if (!mss) {\r\n                // state.sessions[state.currentHr.username+'#'+msg.to] = [];\r\n                //当聊天发送消息时，会自动刷新聊天页\r\n                Vue.set(state.sessions, state.currentHr.username + '#' + msg.to, []);\r\n            }\r\n            state.sessions[state.currentHr.username + '#' + msg.to].push({\r\n                content: msg.content,\r\n                date: new Date(),\r\n                self: !msg.notSelf\r\n            })\r\n        },\r\n        INIT_DATA(state) {\r\n            //浏览器本地的历史聊天记录可以在这里完成\r\n            let data = localStorage.getItem('vue-chat-session');\r\n            if (data) {\r\n                state.sessions = JSON.parse(data);\r\n            }\r\n        },\r\n        //把除了登录者之外的其他成员拿到，放到hrs里面去\r\n        INIT_HR(state, data) {\r\n            state.hrs = data;\r\n        }\r\n    },\r\n    actions: {\r\n        //该方法用于登陆之后就马上连接上聊天\r\n        connect(context) {\r\n            //写上连接地址，也就是后台WebSocketConfig配置类那里配置的registerStompEndpoints\r\n            context.state.stomp = Stomp.over(new SockJS('/ws/ep'));\r\n            //发起连接，第一个参数是一些额外的选项，这里可以暂时不填；第二个参数就是连接成功的回调；第三个则是连接失败的回调\r\n            context.state.stomp.connect({}, success => {\r\n                //订阅消息，这里的路径前面一定要加前缀user，原理和SpringSecurity角色前面加ROLE一样；msg就是服务端发回来的消息\r\n                context.state.stomp.subscribe('/user/queue/chat', msg => {\r\n                    let receiveMsg = JSON.parse(msg.body);  //msg中的body才是消息内容\r\n                    if (!context.state.currentSession || receiveMsg.from != context.state.currentSession.username) {\r\n                        Notification.info({\r\n                            title: '【' + receiveMsg.fromNickname + '】发来一条消息',\r\n                            message: receiveMsg.content.length > 10 ? receiveMsg.content.substr(0, 10) : receiveMsg.content,\r\n                            position: 'bottom-right'\r\n                        })\r\n                        Vue.set(context.state.isDot, context.state.currentHr.username + '#' + receiveMsg.from, true);\r\n                    }\r\n                    receiveMsg.notSelf = true;  //接收到的信息并不是接收人发送的，而是对方发信息过来的\r\n                    receiveMsg.to = receiveMsg.from; //to要改成from，举个例子：我跟李白说话，我发出去的消息，李白接收了；若不做处理，那么就变成了李白跟李白在对话\r\n                    context.commit('addMessage', receiveMsg);\r\n                })\r\n            }, error => {\r\n\r\n            })\r\n        },\r\n        initData(context) {\r\n            context.commit('INIT_DATA')\r\n            getRequest(\"/chat/hrs\").then(resp=>{\r\n                if (resp){\r\n                    context.commit('INIT_HR',resp)\r\n                }\r\n            })\r\n        }\r\n    }\r\n\r\n})\r\n\r\nstore.watch(function (state) {\r\n    return state.sessions\r\n}, function (val) {\r\n    localStorage.setItem('vue-chat-session', JSON.stringify(val));\r\n}, {\r\n    deep: true/*这个貌似是开启watch监测的判断,官方说明也比较模糊*/\r\n})\r\n\r\nexport default store;"]}]}